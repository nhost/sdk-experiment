Main entry point for the Nhost JavaScript SDK.

This package provides a unified client for interacting with Nhost services:

- Authentication
- Storage
- GraphQL
- Functions

## Example

You can import and use this package with:

```ts
import { createClient } from "@nhost/nhost-js";
```

and use it like:

```ts
const nhost = createClient({
  subdomain,
  region,
});

// Sign in with email/password
// This will create a session and persist it in the storage
// Subsequent calls will use the session from the storage
// If the session is about to expire, it will be refreshed
// automatically
await nhost.auth.signUpEmailPassword({
  email,
  password,
});

const uplFilesResp = await nhost.storage.uploadFiles({
  "file[]": [
    new File(["test1"], "file-1", { type: "text/plain" }),
    new File(["test2 is larger"], "file-2", { type: "text/plain" }),
  ],
});
console.log(JSON.stringify(uplFilesResp, null, 2));
// {
//   "data": {
//     "processedFiles": [
//       {
//         "id": "c0e83185-0ce5-435c-bd46-9841adc30699",
//         "name": "file-1",
//         "size": 5,
//         "bucketId": "default",
//         "etag": "\"5a105e8b9d40e1329780d62ea2265d8a\"",
//         "createdAt": "2025-05-09T17:26:04.579839+00:00",
//         "updatedAt": "2025-05-09T17:26:04.589692+00:00",
//         "isUploaded": true,
//         "mimeType": "text/plain",
//         "uploadedByUserId": "",
//         "metadata": null
//       },
//       {
//         "id": "3f189004-21fd-42d0-be1d-1ead021ab167",
//         "name": "file-2",
//         "size": 15,
//         "bucketId": "default",
//         "etag": "\"302e888c5e289fe6b02115b748771ee9\"",
//         "createdAt": "2025-05-09T17:26:04.59245+00:00",
//         "updatedAt": "2025-05-09T17:26:04.596831+00:00",
//         "isUploaded": true,
//         "mimeType": "text/plain",
//         "uploadedByUserId": "",
//         "metadata": null
//       }
//     ]
//   },
//   "status": 201,
//   "headers": {
//     "content-length": "644",
//     "content-type": "application/json; charset=utf-8",
//     "date": "Fri, 09 May 2025 17:26:04 GMT"
//   }
// }

const graphResp = await nhost.graphql.post({
  query: `
   query {
     files {
       name
       size
       mimeType
     }
   }
 `,
});

console.log(JSON.stringify(graphResp, null, 2));
// {
//   "body": {
//     "data": {
//       "files": [
//         {
//           "name": "file-1",
//           "size": 5,
//           "mimeType": "text/plain"
//         },
//         {
//           "name": "file-2",
//           "size": 15,
//           "mimeType": "text/plain"
//         }
//       ]
//     }
//   },
//   "status": 200,
//   "headers": {}
// }
```

## Error handling

The SDK will throw errors on most operations if the request returns a non-2xx status code or
if the request fails entirely (i.e., due to network errors). A continuation you can see
how you can handle errors thrown by the SDK.

### Auth

```ts
// Needs the following imports:
//
// import {
//   type ErrorResponse,
// } from "@nhost/nhost-js/auth";
// import {
//   type FetchError,
// } from "@nhost/nhost-js/fetch";
//
const nhost = createClient({
  subdomain,
  region,
});
try {
  await nhost.auth.signInEmailPassword({
    email,
    password,
  });

  expect(true).toBe(false); // This should not be reached
} catch (error) {
  const err = error as FetchError<ErrorResponse>;
  console.log("Error:", err);
  // Error: {
  //   body: {
  //     error: 'invalid-email-password',
  //     message: 'Incorrect email or password',
  //     status: 401
  //   },
  //   status: 401,
  //   headers: {
  //     'content-length': '88',
  //     'content-type': 'application/json',
  //     date: 'Mon, 12 May 2025 08:08:28 GMT'
  //   }
  // }

  // error handling...
```

### Storage

```ts
// Needs the following imports:
//
// import {
//   type ErrorResponse,
// } from "@nhost/nhost-js/storage";
// import {
//   type FetchError,
// } from "@nhost/nhost-js/fetch";
//
const nhost = createClient({
  subdomain,
  region,
});
try {
  await nhost.storage.uploadFiles({
    "file[]": [new File(["test1"], "file-1", { type: "text/plain" })],
  });

  expect(true).toBe(false); // This should not be reached
} catch (error) {
  const err = error as FetchError<ErrorResponse>;
  console.log("Error:", err);
  // Error: {
  //   body: { error: { message: 'you are not authorized' } },
  //   status: 403,
  //   headers: {
  //     'content-length': '46',
  //     'content-type': 'application/json; charset=utf-8',
  //     date: 'Mon, 12 May 2025 08:18:52 GMT'
  //   }
  // }

  // error handling...
```

### GraphQL

```ts
// Needs the following imports:
//
// import {
//   type GraphQLResponse,
// } from "@nhost/nhost-js/graphql";
// import {
//   type FetchError,
// } from "@nhost/fetch";
//
const nhost = createClient({
  subdomain,
  region,
});

try {
  await nhost.graphql.post({
    query: `
      query GetRestrictedObject {
        restrictedObject {
          restrictedField
        }
      }
    `,
  });
} catch (error) {
  const resp = error as FetchError<GraphQLResponse>;

  console.log("Error:", JSON.stringify(resp, null, 2));
  // Error: {
  //   "body": {
  //     "errors": [
  //       {
  //         "message": "field 'restrictedObject' not found in type: 'query_root'",
  //         "extensions": {
  //           "path": "$.selectionSet.restrictedObject",
  //           "code": "validation-failed"
  //         }
  //       }
  //     ]
  //   },
  //   "status": 200,
  //   "headers": {}
  // }
  //
  // error handling...
```

### Functions

```ts
// Needs the following imports:
//
// import { FetchError } from "@nhost/nhost-js/fetch";
//

const nhost = createClient({
  subdomain,
  region,
});

try {
  await nhost.functions.fetch("/crash", {
    method: "POST",
    headers: {
      Accept: "application/json",
    },
  });
} catch (error) {
  const resp = error as FetchError<string>;
  console.log("Error:", resp);
  // Error: {
  //   status: 500,
  //   body: '<!DOCTYPE html>\n' +
  //     '<html lang="en">\n' +
  //     '<head>\n' +
  //     '<meta charset="utf-8">\n' +
  //     '<title>Error</title>\n' +
  //     '</head>\n' +
  //     '<body>\n' +
  //     '<pre>Error: This is an unhandled error<br> &nbsp; &nbsp;at default (/opt/project/functions/crash.ts:4:11)<br> &nbsp; &nbsp;at Layer.handle [as handle_request] (/usr/local/lib/node_modules/express/lib/router/layer.js:95:5)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:144:13)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)<br> &nbsp; &nbsp;at next (/usr/local/lib/node_modules/express/lib/router/route.js:140:7)</pre>\n' +
  //     '</body>\n' +
  //     '</html>\n',
  //   headers: Headers {
  //     'content-length': '1055',
  //     'content-security-policy': "default-src 'none'",
  //     'content-type': 'text/html; charset=utf-8',
  //     date: 'Tue, 13 May 2025 11:20:04 GMT',
  //     'x-content-type-options': 'nosniff'
  //   }
  // }
  //
  // error handling...
```

## Classes

### CookieStorage

Cookie-based storage implementation.
This storage uses web browser cookies to store the session so it's not
available in server-side environments. It is useful though for sinchronizing
sessions between client and server environments.

#### Implements

- [`SessionStorageBackend`](#sessionstoragebackend)

#### Constructors

##### Constructor

```ts
new CookieStorage(options?: object): CookieStorage;
```

Creates a new CookieStorage instance

###### Parameters

| Parameter                 | Type                                                                                                                              | Description                                                     |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| `options?`                | \{ `cookieName?`: `string`; `expirationDays?`: `number`; `sameSite?`: `"strict"` \| `"lax"` \| `"none"`; `secure?`: `boolean`; \} | Configuration options                                           |
| `options.cookieName?`     | `string`                                                                                                                          | Name of the cookie to use (defaults to "nhostSession")          |
| `options.expirationDays?` | `number`                                                                                                                          | Number of days until the cookie expires (defaults to 30)        |
| `options.sameSite?`       | `"strict"` \| `"lax"` \| `"none"`                                                                                                 | SameSite policy for the cookie (defaults to "lax")              |
| `options.secure?`         | `boolean`                                                                                                                         | Whether to set the Secure flag on the cookie (defaults to true) |

###### Returns

[`CookieStorage`](#cookiestorage)

#### Methods

##### get()

```ts
get(): null | Session;
```

Gets the session from cookies

###### Returns

`null` \| [`Session`](auth#session)

The stored session or null if not found

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`get`](#get-8)

##### remove()

```ts
remove(): void;
```

Removes the session cookie

###### Returns

`void`

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`remove`](#remove-8)

##### set()

```ts
set(value: Session): void;
```

Sets the session in a cookie

###### Parameters

| Parameter | Type                          | Description          |
| --------- | ----------------------------- | -------------------- |
| `value`   | [`Session`](auth#session) | The session to store |

###### Returns

`void`

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`set`](#set-8)

---

### LocalStorage

Browser localStorage implementation of StorageInterface.
Persists the session across page reloads and browser restarts.

#### Implements

- [`SessionStorageBackend`](#sessionstoragebackend)

#### Constructors

##### Constructor

```ts
new LocalStorage(options?: object): LocalStorage;
```

Creates a new LocalStorage instance

###### Parameters

| Parameter             | Type                           | Description                                                 |
| --------------------- | ------------------------------ | ----------------------------------------------------------- |
| `options?`            | \{ `storageKey?`: `string`; \} | Configuration options                                       |
| `options.storageKey?` | `string`                       | The key to use in localStorage (defaults to "nhostSession") |

###### Returns

[`LocalStorage`](#localstorage)

#### Methods

##### get()

```ts
get(): null | Session;
```

Gets the session from localStorage

###### Returns

`null` \| [`Session`](auth#session)

The stored session or null if not found

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`get`](#get-8)

##### remove()

```ts
remove(): void;
```

Removes the session from localStorage

###### Returns

`void`

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`remove`](#remove-8)

##### set()

```ts
set(value: Session): void;
```

Sets the session in localStorage

###### Parameters

| Parameter | Type                          | Description          |
| --------- | ----------------------------- | -------------------- |
| `value`   | [`Session`](auth#session) | The session to store |

###### Returns

`void`

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`set`](#set-8)

---

### MemoryStorage

In-memory storage implementation for non-browser environments or when
persistent storage is not available or desirable.

#### Implements

- [`SessionStorageBackend`](#sessionstoragebackend)

#### Constructors

##### Constructor

```ts
new MemoryStorage(): MemoryStorage;
```

###### Returns

[`MemoryStorage`](#memorystorage)

#### Methods

##### get()

```ts
get(): null | Session;
```

Gets the session from memory

###### Returns

`null` \| [`Session`](auth#session)

The stored session or null if not set

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`get`](#get-8)

##### remove()

```ts
remove(): void;
```

Clears the session from memory

###### Returns

`void`

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`remove`](#remove-8)

##### set()

```ts
set(value: Session): void;
```

Sets the session in memory

###### Parameters

| Parameter | Type                          | Description          |
| --------- | ----------------------------- | -------------------- |
| `value`   | [`Session`](auth#session) | The session to store |

###### Returns

`void`

###### Implementation of

[`SessionStorageBackend`](#sessionstoragebackend).[`set`](#set-8)

---

### NhostClient

Main client class that provides access to all Nhost services

#### Constructors

##### Constructor

```ts
new NhostClient(
   auth: Client,
   storage: Client,
   graphql: Client,
   functions: Client,
   sessionStorage: SessionStorage): NhostClient;
```

Create a new Nhost client. This constructor is reserved for advanced use cases.
For typical usage, use [createClient](#createclient) instead.

###### Parameters

| Parameter        | Type                                  | Description                                    |
| ---------------- | ------------------------------------- | ---------------------------------------------- |
| `auth`           | [`Client`](auth#client)           | Authentication client                          |
| `storage`        | [`Client`](storage#client)        | Storage client                                 |
| `graphql`        | [`Client`](graphql#client)        | GraphQL client                                 |
| `functions`      | [`Client`](functions#client)      | Functions client                               |
| `sessionStorage` | [`SessionStorage`](#sessionstorage-1) | Storage implementation for session persistence |

###### Returns

[`NhostClient`](#nhostclient)

#### Properties

| Property                                     | Type                                  | Description                                                                                   |
| -------------------------------------------- | ------------------------------------- | --------------------------------------------------------------------------------------------- |
| <a id="auth"></a> `auth`                     | [`Client`](auth#client)           | Authentication client providing methods for user sign-in, sign-up, and session management     |
| <a id="functions"></a> `functions`           | [`Client`](functions#client)      | Functions client providing methods for invoking serverless functions                          |
| <a id="graphql"></a> `graphql`               | [`Client`](graphql#client)        | GraphQL client providing methods for executing GraphQL operations against your Hasura backend |
| <a id="sessionstorage"></a> `sessionStorage` | [`SessionStorage`](#sessionstorage-1) | Storage implementation used for persisting session information                                |
| <a id="storage"></a> `storage`               | [`Client`](storage#client)        | Storage client providing methods for file operations (upload, download, delete)               |

#### Methods

##### clearSession()

```ts
clearSession(): void;
```

Clear the session from storage

###### Returns

`void`

##### getUserSession()

```ts
getUserSession(): null | Session;
```

Get the current session from storage

###### Returns

`null` \| [`Session`](auth#session)

The current session or null if no session exists

###### Example

```ts
const session = nhost.getUserSession();
if (session) {
  console.log("User is authenticated:", session.user.id);
} else {
  console.log("No active session");
}
```

##### refreshSession()

```ts
refreshSession(marginSeconds: number): Promise<null | Session>;
```

Refresh the session using the current refresh token
in the storage and update the storage with the new session.

###### Parameters

| Parameter       | Type     | Default value | Description                                                                                                                                                                       |
| --------------- | -------- | ------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `marginSeconds` | `number` | `60`          | The number of seconds before the token expiration to refresh the session. If the token is still valid for this duration, it will not be refreshed. Set to 0 to force the refresh. |

###### Returns

`Promise`&lt;`null` \| [`Session`](auth#session)&gt;

The new session or null if there is currently no session or if refresh fails

---

### SessionStorage

A wrapper around any SessionStorageInterface implementation that adds
the ability to subscribe to session changes.

#### Constructors

##### Constructor

```ts
new SessionStorage(storage: SessionStorageBackend): SessionStorage;
```

Creates a new SessionStorage instance

###### Parameters

| Parameter | Type                                              | Description                                  |
| --------- | ------------------------------------------------- | -------------------------------------------- |
| `storage` | [`SessionStorageBackend`](#sessionstoragebackend) | The underlying storage implementation to use |

###### Returns

[`SessionStorage`](#sessionstorage-1)

#### Methods

##### get()

```ts
get(): null | Session;
```

Gets the session from the underlying storage

###### Returns

`null` \| [`Session`](auth#session)

The stored session or null if not found

##### onChange()

```ts
onChange(callback: SessionChangeCallback): () => void;
```

Subscribe to session changes

###### Parameters

| Parameter  | Type                    | Description                                           |
| ---------- | ----------------------- | ----------------------------------------------------- |
| `callback` | `SessionChangeCallback` | Function that will be called when the session changes |

###### Returns

An unsubscribe function to remove this subscription

```ts
(): void;
```

###### Returns

`void`

##### remove()

```ts
remove(): void;
```

Removes the session from the underlying storage and notifies subscribers

###### Returns

`void`

##### set()

```ts
set(value: Session): void;
```

Sets the session in the underlying storage and notifies subscribers

###### Parameters

| Parameter | Type                          | Description          |
| --------- | ----------------------------- | -------------------- |
| `value`   | [`Session`](auth#session) | The session to store |

###### Returns

`void`

## Interfaces

### SessionRefreshOptions

Configuration options for the session refresh middleware

#### Properties

##### marginSeconds?

```ts
optional marginSeconds: number;
```

Number of seconds before token expiration when a refresh should be triggered.
Default is 60 seconds (1 minute).

---

### SessionStorageBackend

Session storage interface for session persistence.
This interface can be implemented to provide custom storage solutions.

#### Methods

##### get()

```ts
get(): null | Session;
```

Get the current session from storage

###### Returns

`null` \| [`Session`](auth#session)

The stored session or null if not found

##### remove()

```ts
remove(): void;
```

Remove the session from storage

###### Returns

`void`

##### set()

```ts
set(value: Session): void;
```

Set the session in storage

###### Parameters

| Parameter | Type                          | Description          |
| --------- | ----------------------------- | -------------------- |
| `value`   | [`Session`](auth#session) | The session to store |

###### Returns

`void`

## Variables

### DEFAULT_SESSION_KEY

```ts
const DEFAULT_SESSION_KEY: "nhostSession" = "nhostSession";
```

Default storage key used for storing the Nhost session

## Functions

### createAttachAccessTokenMiddleware()

```ts
function createAttachAccessTokenMiddleware(
  storage: SessionStorage,
): ChainFunction;
```

Creates a fetch middleware that adds the Authorization header with the current access token.

This middleware:

1. Gets the current session from storage
2. Adds the authorization header with the access token to outgoing requests

This middleware should be used after the refresh middleware in the chain to
ensure the most recent token is used.

#### Parameters

| Parameter | Type                                  | Description                                        |
| --------- | ------------------------------------- | -------------------------------------------------- |
| `storage` | [`SessionStorage`](#sessionstorage-1) | Storage implementation for retrieving session data |

#### Returns

[`ChainFunction`](fetch#chainfunction)

A middleware function that adds Authorization headers

---

### createSessionRefreshMiddleware()

```ts
function createSessionRefreshMiddleware(
  refreshSession: (
    auth: Client,
    storage: SessionStorage,
    marginSeconds: number,
  ) => Promise<null | Session>,
  auth: Client,
  storage: SessionStorage,
  options?: SessionRefreshOptions,
): ChainFunction;
```

Creates a fetch middleware that automatically refreshes authentication tokens.

This middleware:

1. Checks if the current token is about to expire
2. If so, uses the refresh token to obtain a new access token

The middleware handles token refresh transparently, so the application
doesn't need to manually refresh tokens.

#### Parameters

| Parameter        | Type                                                                                                                                                                           | Description                                        |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------- |
| `refreshSession` | (`auth`: [`Client`](auth#client), `storage`: [`SessionStorage`](#sessionstorage-1), `marginSeconds`: `number`) => `Promise`&lt;`null` \| [`Session`](auth#session)&gt; | -                                                  |
| `auth`           | [`Client`](auth#client)                                                                                                                                                    | -                                                  |
| `storage`        | [`SessionStorage`](#sessionstorage-1)                                                                                                                                          | Storage implementation for persisting session data |
| `options?`       | [`SessionRefreshOptions`](#sessionrefreshoptions)                                                                                                                              | Configuration options for token refresh behavior   |

#### Returns

[`ChainFunction`](fetch#chainfunction)

A middleware function that can be used in the fetch chain

---

### createSessionResponseMiddleware()

```ts
function createSessionResponseMiddleware(
  storage: SessionStorage,
): ChainFunction;
```

Creates a fetch middleware that automatically extracts and stores session data from API responses.

This middleware:

1. Monitors responses from authentication-related endpoints
2. Extracts session information when present
3. Stores the session in the provided storage implementation
4. Handles session removal on sign-out

This ensures that session data is always up-to-date in storage after operations
that create or invalidate sessions.

#### Parameters

| Parameter | Type                                  | Description                                        |
| --------- | ------------------------------------- | -------------------------------------------------- |
| `storage` | [`SessionStorage`](#sessionstorage-1) | Storage implementation for persisting session data |

#### Returns

[`ChainFunction`](fetch#chainfunction)

A middleware function that can be used in the fetch chain
